<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>åˆ†å¸³è¨ˆç®—å™¨</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      padding: 20px;
    }
    .box {
      background: white;
      padding: 20px;
      max-width: 500px;
      margin: auto;
      border-radius: 8px;
    }
    h2 {
      text-align: center;
    }
    label {
      display: block;
      margin-top: 10px;
    }
    input {
      width: 100%;
      padding: 6px;
      margin-top: 4px;
    }
    button {
      margin-top: 15px;
      width: 100%;
      padding: 10px;
      font-size: 16px;
    }
    .result {
      margin-top: 20px;
      background: #eef;
      padding: 10px;
      border-radius: 6px;
    }
  </style>
</head>
<body>

<div class="box">
  <h2>ğŸ½ åˆ†å¸³è¨ˆç®—å™¨</h2>

  <label>åƒé£¯äººæ•¸
    <input type="number" id="people" min="1" value="4">
  </label>

  <label>ç¸½é‡‘é¡
    <input type="number" id="total" min="0" value="2000">
  </label>

  <label>å…ˆä»˜éŒ¢çš„äººï¼ˆæ ¼å¼ï¼šåå­— é‡‘é¡ï¼Œä¸€è¡Œä¸€å€‹ï¼‰</label>
  <textarea id="paidList" rows="5" style="width:100%;">
A 800
B 600
  </textarea>

  <button onclick="calculate()">è¨ˆç®—</button>

  <div class="result" id="result"></div>
</div>

<script>
function calculate() {
  const people = Number(document.getElementById("people").value);
  const total = Number(document.getElementById("total").value);
  const paidText = document.getElementById("paidList").value.trim();
  const resultDiv = document.getElementById("result");

  if (people <= 0 || total <= 0) {
    resultDiv.innerHTML = "è«‹è¼¸å…¥æ­£ç¢ºçš„äººæ•¸èˆ‡é‡‘é¡";
    return;
  }

  const perPerson = total / people;
  const paid = {};

  if (paidText !== "") {
    paidText.split("\n").forEach(line => {
      const [name, amount] = line.trim().split(/\s+/);
      const money = Number(amount);
      if (name && !isNaN(money)) {
        paid[name] = money;
      }
    });
  }

  // å»ºç«‹ balance
  const balances = [];
  for (let name in paid) {
    balances.push({
      name,
      balance: paid[name] - perPerson
    });
  }

  const unpaidCount = people - balances.length;
  for (let i = 0; i < unpaidCount; i++) {
    balances.push({
      name: `æœªä»˜è€…${i + 1}`,
      balance: -perPerson
    });
  }

  const creditors = balances.filter(b => b.balance > 0.01);
  const debtors   = balances.filter(b => b.balance < -0.01);

  const transfers = [];
  let i = 0, j = 0;

  while (i < debtors.length && j < creditors.length) {
    const debtor = debtors[i];
    const creditor = creditors[j];

    const amount = Math.min(
      -debtor.balance,
      creditor.balance
    );

    transfers.push(
      `${debtor.name} â†’ ${creditor.name}ï¼š${amount.toFixed(2)} å…ƒ`
    );

    debtor.balance += amount;
    creditor.balance -= amount;

    if (Math.abs(debtor.balance) < 0.01) i++;
    if (Math.abs(creditor.balance) < 0.01) j++;
  }

  // è¼¸å‡º
  let output = `<b>æ¯äººæ‡‰ä»˜ï¼š</b> ${perPerson.toFixed(2)} å…ƒ<br><br>`;

  balances.forEach(b => {
    if (b.balance > 0.01) {
      output += `${b.name} å¤šä»˜ ${b.balance.toFixed(2)} å…ƒ<br>`;
    } else if (b.balance < -0.01) {
      output += `${b.name} å°‘ä»˜ ${Math.abs(b.balance).toFixed(2)} å…ƒ<br>`;
    } else {
      output += `${b.name} å‰›å¥½ä»˜æ¸…<br>`;
    }
  });

  output += `<br><b>ğŸ” æœ€ä½³åŒ–è½‰å¸³æ–¹å¼ï¼š</b><br>`;
  transfers.forEach(t => {
    output += `${t}<br>`;
  });

  resultDiv.innerHTML = output;
}
</script>


</body>
</html>
